<!DOCTYPE html>
<html>
  <head>
    <title>Subir Archivo</title>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <script>
      function cargarLista() {
        fetch("/list")
          .then((response) => response.json())
          .then((data) => {
            const listaArchivos = document.getElementById("listaArchivos");
            listaArchivos.innerHTML = "";
            data.forEach((archivo) => {
              const div = document.createElement("div");
              div.textContent = archivo.name;
              const btnEliminar = document.createElement("button");
              btnEliminar.textContent = "Eliminar";
              btnEliminar.addEventListener("click", () => {
                fetch("/delete/" + archivo.name, { method: "DELETE" })
                  .then((response) => {
                    if (!response.ok) {
                      throw new Error("Error al eliminar el archivo");
                    }
                    return response.text();
                  })
                  .then((message) => {
                    console.log(message);
                  })
                  .catch((error) => {
                    console.error(error);
                  });
                cargarLista();
              });
              const btnDescargar = document.createElement("button");
              btnDescargar.textContent = "Descargar";
              btnDescargar.addEventListener("click", () => {
                const link = document.createElement("a");
                link.href = "/download/" + archivo.name;
                link.download = archivo.name;
                link.click();
              });

              div.appendChild(btnEliminar);
              div.appendChild(btnDescargar);
              listaArchivos.appendChild(div);
            });
          })
          .catch((error) => {
            console.error("Error al cargar la lista de archivos:", error);
          });
      }

      cargarLista();
    </script>
  </head>

  <body>
    <header>
      <img
        src="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png"
      />
      <span class="title">Drive</span>
    </header>

    <main>
      <section>

      </section>

      <section class="container-files">
        <h1>Subir Archivo al Servidor FTP</h1>
        <form id="uploadForm" enctype="multipart/form-data">
          <span class="custom-file-upload">
            <label for="file">Choose a file</label>
            <input
            type="file"
            name="file"
            accept=".jpg, .png, .pdf, .doc, .docx, .xls, .xlsx, .ppt, .pptx"
          />
          </span>
          
          <button type="submit">Subir</button>
        </form>
      </section>
     
    </main>

    <footer></footer>
    <script>
      document
        .getElementById("uploadForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Evitar que el formulario se envíe de la forma predeterminada

          const formData = new FormData(this); // Crear un objeto FormData a partir del formulario

          fetch("/upload", {
            method: "POST",
            body: formData,
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Error al subir el archivo");
              }
              return response.text();
            })
            .then((message) => {
              console.log(message);
              cargarLista(); // Recargar la lista de archivos después de subir
            })
            .catch((error) => {
              console.error(error);
            });
        });
    </script>

    <br />
    <div id="listaArchivos"></div>
  </body>
</html>
